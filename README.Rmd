---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```
# tbrf

The goal of tbrf is to provide time-window based rolling statistical functions. The package differs from other rolling statistic packages because the intended use is for irregular measured data.

An example use case is water quality data that is measured at irregular time intervals. Regulatory compliance is often based on a statistical average measure or exceedance probability applied to all samples collected in the previous 7-years.

tbrf identifies the previous n measurements within the specified time window, applies the function, and outputs a varaible with the result of the rolling statistical measure.

## Installation

tbrf is still under development and can be installed from github with:

``` r
devtools::install.github("mps9506/tbrf")
```

## Examples


### Rolling Geometric Mean
```{r example, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
library(tbrf)
library(dplyr)
library(ggplot2)

## Generate sample data
set.seed(100)
df <- data.frame(
  date = sample(seq(as.Date('2000-01-01'), 
                    as.Date('2015/12/30'), by = "day"), 50),
  value = rexp(50, 1/100)
)

head(df)

## apply the geomean to each row
df <- tbr_gmean(df, x = value, tcolumn = date,
                unit = "years", n = 5, conf.level = 0.95)
df

## in a tidy pipeline
set.seed(100)
df <- data.frame(
  date = sample(seq(as.Date('2000-01-01'), 
                    as.Date('2015/12/30'), by = "day"), 50),
  value = rexp(50, 1/100)
)

df <- df %>%
  tbr_gmean(x = value, tcolumn = date, unit = "years",
            n = 5, conf.level = 0.95)
df

ggplot(df) +
  geom_point(aes(date, value)) +
  geom_line(aes(date, mean)) +
  geom_ribbon(aes(x = date, ymin = lwr.ci, ymax = upr.ci), alpha = 0.4) +
  scale_y_log10()
```

